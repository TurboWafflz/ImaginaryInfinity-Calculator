stages:
  - build
  - build-stage-2
debian packager:
  image: ubuntu:latest
  stage: build
  script:
    - ./installer.sh --make-deb
  artifacts:
    paths:
      - iicalc.deb
  only:
    - development

buildrpm:
  image: fedora:latest
  stage: build
  script:
    - ./installer.sh --make-rpm
  artifacts:
    paths:
      - iicalc.rpm
  only:
    - development
    
AppImage packager:
    stage: build
    script:
        - apt update
        - apt install -y file wget
        - ./installer.sh --make-appImage
    artifacts:
        paths:
            - ImaginaryInfinity_Calculator-x86_64.AppImage
    only:
        - development
buildexe:
  image: docker:latest
  stage: build
  variables:
    DOCKER_DRIVER: overlay2
  services:
    - docker:dind
  before_script:
    - cp .installer/build/windows/iicalc.iss ./
  script:
    - docker run --rm -i -v "$PWD:/work" amake/innosetup iicalc.iss
    - mv Output/iicalc.exe ./
  artifacts:
    paths:
      - iicalc.exe
  only:
    - development

buildpkg:
  image: archlinux:latest
  stage: build-stage-2
  before_script:
    - pacman -Syu glibc bash binutils fakeroot pkgfile dpkg openssh sudo git bash-completion python-pip --noconfirm --needed
    - eval $(ssh-agent -s)
    - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
    - mkdir -p ~/.ssh
    - ssh-keyscan -v -t rsa,dsa,ecdsa,ed25519 aur.archlinux.org >>~/.ssh/known_hosts
    - chmod 700 ~/.ssh
    - git config --global user.name "TabulateJarl8"
    - git config --global user.email "tabulatejarl8@gmail.com"
  script:
    - ./installer.sh --make-pkg -b -h
    - git clone ssh://aur@aur.archlinux.org/iicalc-beta.git iicalcaur
    - git config --global pull.rebase false
    - cp -v iicalc-arch/* iicalcaur/
    - cd iicalcaur
    - git add .
    - git commit -m "$CI_COMMIT_MESSAGE"
    - git show-ref
    - git push
    - cd ..

  artifacts:
    paths:
      - iicalc-any.pkg.tar.zst
  only:
    - development
